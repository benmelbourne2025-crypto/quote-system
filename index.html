<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignedOn | Quote Master</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root { --brand-dark: #0f172a; --brand-blue: #2563eb; }
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; background-color: #f8fafc; }
        [v-cloak] { display: none !important; }

        /* 屏幕显示样式 */
        .input-ghost { background: transparent; transition: all 0.2s; }
        .input-ghost:focus { background: white; box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2); border-radius: 4px; }
        
        /* 内部数据列：屏幕显示淡色，打印完全隐藏 */
        .internal-col input { color: #64748b; font-size: 0.85em; }
        .internal-col input:focus { color: #0f172a; }

        /* ==================== 核心修复：打印专用样式 ==================== */
        @media print {
            @page { margin: 10mm; size: A4; }
            
            body { 
                background: white !important; 
                -webkit-print-color-adjust: exact !important; 
                margin: 0 !important; padding: 0 !important;
            }

            /* 1. 隐藏导航、按钮、添加行、删除图标 */
            nav, button, .no-print, .fa-trash-alt, .fa-times { 
                display: none !important; 
            }

            /* 2. 核心：隐藏所有标记为 "internal-col" 的列 (成本/利润/链接) */
            .internal-col { 
                display: none !important; 
            }
            /* 调整剩余列宽，让表格打印时铺满 */
            .print-wide { width: auto !important; }

            /* 3. 修复截断问题：允许溢出，允许自动高度 */
            html, body, #app, main {
                height: auto !important;
                overflow: visible !important;
                width: 100% !important;
                max-width: none !important;
                position: relative !important;
                box-shadow: none !important;
                border: none !important;
            }
            
            main { padding: 0 !important; margin: 0 !important; }

            /* 4. 分页控制 */
            .page-break { page-break-inside: avoid; margin-bottom: 2rem; }
            tr { page-break-inside: avoid; }

            /* 5. 输入框纯文本化 */
            input, textarea { 
                border: none !important; 
                background: transparent !important; 
                resize: none !important; 
                padding: 0 !important; 
                margin: 0 !important;
            }
        }
    </style>
</head>
<body class="text-slate-800 pb-32">

<div id="app" v-cloak>
    <nav class="bg-slate-900 text-white sticky top-0 z-50 shadow-lg no-print">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center text-xs">
            <div class="flex items-center space-x-6">
                <span class="text-xl font-black italic tracking-tighter">SIGNED<span class="text-blue-500">ON</span></span>
                <div class="flex space-x-2 border-l border-slate-700 pl-6">
                    <button @click="actions.exportQuote" class="hover:bg-slate-800 px-3 py-1.5 rounded transition flex items-center gap-2">
                        <i class="fas fa-download text-blue-400"></i> Save .json
                    </button>
                    <label class="hover:bg-slate-800 px-3 py-1.5 rounded transition flex items-center gap-2 cursor-pointer">
                        <i class="fas fa-folder-open text-yellow-400"></i> Load .json
                        <input type="file" class="hidden" @change="actions.importQuote" accept=".json">
                    </label>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <button @click="actions.downloadMasterDB" class="text-slate-400 hover:text-green-400 transition flex gap-2" title="Update GitHub Database">
                    <i class="fas fa-database"></i> Export Master DB
                </button>
                <div class="h-4 w-px bg-slate-700"></div>
                <button @click="actions.reset" class="text-slate-400 hover:text-red-400 transition font-bold">RESET</button>
                <button @click="window.print()" class="bg-blue-600 hover:bg-blue-500 text-white px-5 py-2 rounded font-bold shadow-lg transition flex items-center gap-2">
                    <i class="fas fa-print"></i> PRINT PDF
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto mt-10 bg-white min-h-[1000px] shadow-2xl rounded-xl overflow-visible print:shadow-none print:mt-0 print:rounded-none">
        
        <header class="p-12 border-b border-slate-100 flex justify-between items-end">
            <div class="w-2/3">
                <label class="text-[10px] font-bold text-blue-600 uppercase tracking-widest mb-1 block">Project Reference</label>
                <input v-model="quote.meta.title" class="w-full text-4xl font-black text-slate-900 outline-none placeholder-slate-200 uppercase" placeholder="PROJECT NAME">
            </div>
            <div class="w-1/3 text-right space-y-2">
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Prepared For</label>
                    <input v-model="quote.meta.client" class="w-full text-right font-bold text-slate-700 outline-none bg-slate-50 focus:bg-white p-1 rounded" placeholder="Client Name">
                </div>
                <div class="text-xs text-slate-400 font-medium">Date: <span class="text-slate-800 font-bold">{{ config.currentDate }}</span></div>
            </div>
        </header>

        <div class="p-12 space-y-10">
            <div v-for="(section, sIdx) in quote.sections" :key="section.id" class="page-break group/section">
                <div class="flex items-center gap-4 mb-4 border-b-2 border-slate-100 pb-2">
                    <div class="bg-slate-900 text-white w-6 h-6 rounded flex items-center justify-center text-xs font-bold">{{ sIdx + 1 }}</div>
                    <input v-model="section.title" class="text-xl font-bold text-slate-800 outline-none w-full bg-transparent" placeholder="Section Name">
                    <button @click="actions.removeSection(sIdx)" class="no-print opacity-0 group-hover/section:opacity-100 text-slate-300 hover:text-red-500 transition px-2"><i class="fas fa-trash-alt"></i></button>
                </div>

                <table class="w-full text-left text-sm border-collapse">
                    <thead>
                        <tr class="text-slate-400 text-[10px] uppercase tracking-widest border-b border-slate-100">
                            <th class="pb-3 pl-2 w-[35%] print-wide">Description & Links</th>
                            <th class="pb-3 text-right w-[10%] internal-col bg-yellow-50/50 text-yellow-600">Cost</th>
                            <th class="pb-3 text-right w-[10%] internal-col bg-yellow-50/50 text-yellow-600">Margin%</th>
                            <th class="pb-3 text-center w-[10%]">Qty</th>
                            <th class="pb-3 text-right w-[15%]">Unit Price</th>
                            <th class="pb-3 text-right w-[15%]">Total</th>
                            <th class="pb-3 w-8 no-print"></th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-50">
                        <tr v-for="(item, iIdx) in section.items" :key="iIdx" class="group/row hover:bg-slate-50 transition">
                            <td class="py-3 pl-2 align-top">
                                <input v-model="item.name" list="dbList" 
                                    @input="logic.handleItemInput(item)" 
                                    @change="logic.learnItem(item)"
                                    class="w-full font
