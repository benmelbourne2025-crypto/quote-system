const { createApp, ref, computed, onMounted } = Vue;

createApp({
    setup() {
        const materialDB = ref([]);
        const quoteData = ref({
            sections: [{ id: 1, title: 'Section 1', items: [{ name: '', qty: 1, price: 0, details: '' }] }]
        });

        // 第一步：从 GitHub 读取数据
        onMounted(async () => {
            try {
                // 自动读取同目录下的 database.json
                const response = await fetch('database.json');
                materialDB.ref = await response.json();
                console.log("Database Loaded!");
            } catch (e) {
                console.error("Failed to load database");
            }
        });

        // 第二步：自动填充功能
        const handleSearch = (item) => {
            // 在数据库中匹配名称
            const match = materialDB.ref.find(m => m.name === item.name);
            if (match) {
                item.price = match.sell; // 自动填充售价
                item.details = `Cost: $${match.cost}`; // 记录成本参考
            }
        };

        const addSection = () => { /* ... */ };
        const addItem = (sIdx) => { /* ... */ };

        return { quoteData, materialDB, handleSearch, addSection, addItem };
    }
}).mount('#app');
